<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css?">
</head>

<body>
    {{>header}}

    <div class="table-div">

        <table class="styled-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Surname</th>
                    <th>Username</th>
                    <th>Email</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {{#if stud}}
                <tr class="form-edit">
                    <form action="/update/{{stud.id}}" method="post">
                        <td id="idInput"><input type="number" name="id" value="{{stud.generatedId}}" disabled></td>
                        <td><input type="text" name="name" value="{{stud.name}}"></td>
                        <td><input type="text" name="surname" value="{{stud.surname}}"></td>
                        <td><input type="text" name="username" value="{{stud.username}}"></td>
                        <td><input type="text" name="email" value="{{stud.email}}"></td>
                        <td><button class="upd-btn">Update</button></td>
                    </form>
                </tr>
                {{/if}}
                {{#if students}}
                {{#each students}}
                <tr class="form-edit">
                    {{!-- <form action="/update/{{id}}"  id="myForm" enctype="multipart/form-data"> --}}
                    <form id="myForm" enctype="multipart/form-data">
                        <td id="idInput"><input type="number" name="id" value="{{generatedId}}" disabled></td>
                        <td><input type="text" name="name" value="{{name}}"></td>
                        <td><input type="text" name="surname" value="{{surname}}"></td>
                        <td><input type="text" name="username" value="{{username}}"></td>
                        <td><input type="text" name="email" value="{{email}}"></td>
                        <td><button class="upd-btn"  onclick="updateStudent('{{id}}')">Update</button></td>
                        {{!-- onclick="updateStudent('{{id}}')" --}}
                    </form>
                </tr>
                {{/each}}
                {{/if}}

            </tbody>
        </table>
    </div>

    {{!-- {{>footer}} --}}

 <script>
        function updateStudent(studentId) {
            // Get the form data
            const formData = new FormData(document.getElementById('myForm'));
console.log(formData)
console.log("aaaaaaaaaaaa")
            // Convert form data to an object
            const formDataObject = {};
            formData.forEach((value, key) => {
                formDataObject[key] = value;
            });

console.log(formDataObject)
console.log("bbbbbbbbbbbbb")
            // Fetch code to send PUT request
            fetch(`/update/${studentId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formDataObject),
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
                .then(data => window.location.href = data.redirect)
            //.then(data => {
                // Handle success response here
              //  console.log('Update request successful', data);
                //alert('Update request successful');
            //})
            .catch(error => {
                // Handle error here
                console.log('Update request error', error);
                alert('Update request failed');
            });
        }
    </script>
</body>
</html>